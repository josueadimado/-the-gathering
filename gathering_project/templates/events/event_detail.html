{% extends 'base.html' %}
{% load static %}

{% block title %}{{ event.name }} - The Gathering{% endblock %}

{% block page_title %}Event Details{% endblock %}

{% block content %}
<div class="mb-4">
    <a href="{% url 'events:list' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Events
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header {% if event.is_upcoming %}bg-success{% else %}bg-secondary{% endif %} text-white">
                <h3 class="mb-0">{{ event.name }}</h3>
            </div>
            <div class="card-body">
                {% if event.image %}
                <div class="mb-4 text-center">
                    <img src="{{ event.image.url }}" alt="{{ event.name }}" class="img-fluid rounded" style="max-height: 400px; width: auto;">
                </div>
                {% endif %}
                <dl class="row">
                    <dt class="col-sm-4">Date:</dt>
                    <dd class="col-sm-8">{{ event.event_date|date:"F d, Y" }}</dd>
                    
                    <dt class="col-sm-4">Time:</dt>
                    <dd class="col-sm-8">{{ event.event_time|time:"g:i A" }}</dd>
                    
                    <dt class="col-sm-4">Type:</dt>
                    <dd class="col-sm-8">{{ event.get_event_type_display }}</dd>
                    
                    {% if event.topic %}
                    <dt class="col-sm-4">Topic:</dt>
                    <dd class="col-sm-8"><strong>{{ event.topic }}</strong></dd>
                    {% endif %}
                    
                    {% if event.location %}
                    <dt class="col-sm-4">Location:</dt>
                    <dd class="col-sm-8">{{ event.location }}</dd>
                    {% endif %}
                    
                    {% if event.description %}
                    <dt class="col-sm-4">Description:</dt>
                    <dd class="col-sm-8">{{ event.description }}</dd>
                    {% endif %}
                    
                    <dt class="col-sm-4">Status:</dt>
                    <dd class="col-sm-8">
                        {% if event.is_active %}
                        <span class="badge bg-success">Active</span>
                        {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                        {% endif %}
                        {% if event.is_upcoming %}
                        <span class="badge bg-info">Upcoming</span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-4">Attendance:</dt>
                    <dd class="col-sm-8">
                        <strong>{{ attendance_count }}</strong> people checked in
                    </dd>
                </dl>
                
                <!-- QR Code Section -->
                <div class="mt-4 pt-4 border-top">
                    <h5 class="mb-3"><i class="bi bi-qr-code"></i> Event QR Code</h5>
                    <div class="text-center">
                        <img src="{% url 'events:qr_code' event.pk %}" alt="Event QR Code" class="img-fluid" style="max-width: 250px; border: 2px solid #dee2e6; border-radius: 8px; padding: 10px; background: white;">
                        <p class="text-muted small mt-2 mb-0">Scan this QR code to quickly access event check-in</p>
                        <a href="{% url 'events:qr_code' event.pk %}" class="btn btn-sm btn-outline-primary mt-2" download>
                            <i class="bi bi-download"></i> Download QR Code
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <a href="{% url 'events:update' event.pk %}" class="btn btn-primary">
                    <i class="bi bi-pencil"></i> Edit Event
                </a>
                <a href="{% url 'attendance:list_by_event' event_id=event.pk %}" class="btn btn-info">
                    <i class="bi bi-people"></i> View Attendance
                </a>
                <a href="{% url 'events:qr_code' event.pk %}" class="btn btn-success" target="_blank">
                    <i class="bi bi-qr-code"></i> Generate QR Code
                </a>
                <a href="{% url 'events:delete' event.pk %}" class="btn btn-danger">
                    <i class="bi bi-trash"></i> Delete Event
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'attendance:check_in' %}?event={{ event.pk }}" class="btn btn-success">
                        <i class="bi bi-check-circle"></i> Check In People
                    </a>
                    <a href="{% url 'attendance:list_by_event' event_id=event.pk %}" class="btn btn-outline-info">
                        <i class="bi bi-list-check"></i> View All Attendance
                    </a>
                    <a href="{% url 'events:qr_code' event.pk %}" class="btn btn-outline-success" target="_blank">
                        <i class="bi bi-qr-code-scan"></i> View QR Code
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

